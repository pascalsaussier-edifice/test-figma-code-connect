{"version":3,"file":"pad-transformer.js","sources":["../../../src/iframe/transformers/pad-transformer.ts"],"sourcesContent":["import { IframeTransformer } from './interface';\n\n/**\n * This transformer is used to transform the pad URL to the embed URL inside the iframe\n * The embed URL is used to create a session for the pad before redirecting to the pad url\n */\nexport class PadIframeTransformer implements IframeTransformer {\n  // Define the pad path\n  private padPath = '/pad/';\n  // Define the embed path\n  private embedPath = '/collaborativeeditor/embed/';\n  onRenderHTML({ HTMLAttributes }) {\n    try {\n      // Get host URL from the current window\n      const currentUrl = window.location.href.split('?')[0];\n      const baseUrl = new URL(currentUrl).origin;\n      // Get Iframe src URL\n      const srcUrl = new URL(HTMLAttributes.src);\n      const pathMatch = srcUrl.pathname.match(\n        new RegExp(`^${this.padPath}(.+)$`),\n      );\n      // Check if the src URL is from the same origin and matches the pad path\n      if (srcUrl.origin === baseUrl && pathMatch && pathMatch[1]) {\n        // Extract pad ID from the URL\n        const padId = pathMatch[1].replace(/^p\\//i, '');\n        // Create a new URL with the embed path\n        const newUrl = new URL(`${baseUrl}${this.embedPath}${padId}`);\n        // Copy search params from the src URL to the new URL\n        srcUrl.searchParams.forEach((value, key) => {\n          newUrl.searchParams.set(key, value);\n        });\n        // Set the new URL\n        HTMLAttributes.src = newUrl.toString();\n      }\n    } catch (e) {\n      console.error('Error transforming pad URL:', e);\n    }\n  }\n}\n"],"names":[],"mappings":"AAMO,MAAM,qBAAkD;AAAA,EAAxD,cAAA;AAEL,SAAQ,UAAU,SAElB,KAAQ,YAAY;AAAA,EAAA;AAAA,EACpB,aAAa,EAAE,kBAAkB;AAC/B,QAAI;AAEF,YAAM,aAAa,OAAO,SAAS,KAAK,MAAM,GAAG,EAAE,CAAC,GAC9C,UAAU,IAAI,IAAI,UAAU,EAAE,QAE9B,SAAS,IAAI,IAAI,eAAe,GAAG,GACnC,YAAY,OAAO,SAAS;AAAA,QAChC,IAAI,OAAO,IAAI,KAAK,OAAO,OAAO;AAAA,MAAA;AAGpC,UAAI,OAAO,WAAW,WAAW,aAAa,UAAU,CAAC,GAAG;AAE1D,cAAM,QAAQ,UAAU,CAAC,EAAE,QAAQ,SAAS,EAAE,GAExC,SAAS,IAAI,IAAI,GAAG,OAAO,GAAG,KAAK,SAAS,GAAG,KAAK,EAAE;AAE5D,eAAO,aAAa,QAAQ,CAAC,OAAO,QAAQ;AAC1C,iBAAO,aAAa,IAAI,KAAK,KAAK;AAAA,QACpC,CAAC,GAED,eAAe,MAAM,OAAO,SAAA;AAAA,MAC9B;AAAA,IACF,SAAS,GAAG;AACV,cAAQ,MAAM,+BAA+B,CAAC;AAAA,IAChD;AAAA,EACF;AACF;"}