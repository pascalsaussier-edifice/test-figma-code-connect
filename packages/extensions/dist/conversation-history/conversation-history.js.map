{"version":3,"file":"conversation-history.js","sources":["../../src/conversation-history/conversation-history.ts"],"sourcesContent":["/**\n * A Tiptap Node extension that creates a conversation history container.\n * This extension groups content blocks that appear after a horizontal rule\n * into a conversation history section.\n *\n * @extends Node\n *\n * @remarks\n * The node is rendered as a div element with the class 'conversation-history'.\n * It can parse HTML elements that match the same structure.\n *\n * For retrocompatibility, this extension also includes a ProseMirror plugin\n * that handles the grouping all the content after an horizontal rules into the\n * conversation-history children block.\n *\n * Usage:\n * ```\n * // Add to your Tiptap editor extensions\n * import { ConversationHistory } from './conversation-history'\n *\n * new Editor({\n *   extensions: [\n *     ConversationHistory,\n *     // ... other extensions\n *   ],\n * })\n * ```\n */\nimport { mergeAttributes, Node } from '@tiptap/core';\nimport { Plugin } from 'prosemirror-state';\n\nexport const ConversationHistory = Node.create({\n  name: 'converstationHistory',\n  group: 'block',\n  content: 'block+',\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div.conversation-history',\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'div',\n      mergeAttributes(HTMLAttributes, { class: 'conversation-history' }),\n      0,\n    ];\n  },\n\n  /**\n   * Adds custom ProseMirror plugins to the editor.\n   * When a horizontal rule is encountered, this plugin collects all nodes\n   * following the horizontal rule until the end of the document.\n   * These nodes are then grouped together and replaced with\n   * a single node of the same type as the plugin's type.\n   *\n   * @returns {Plugin[]} An array of ProseMirror plugins.\n   */\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        appendTransaction: (transactions, oldState, newState) => {\n          const tr = newState.tr;\n          let modified = false;\n          const nodesAfterHr = [];\n\n          newState.doc.descendants((node, pos, parent) => {\n            if (\n              node.type.name === 'horizontalRule' &&\n              parent.type.name === 'doc'\n            ) {\n              const start = pos;\n              const end = newState.doc.content.size;\n\n              newState.doc.nodesBetween(start, end, (n, p, parent) => {\n                if (\n                  n.type.name !== 'horizontalRule' &&\n                  parent.type.name === 'doc'\n                ) {\n                  nodesAfterHr.push({ node: n, pos: p });\n                } else {\n                  return false;\n                }\n              });\n\n              if (nodesAfterHr.length > 0) {\n                const groupNode = this.type.create(\n                  {},\n                  nodesAfterHr.map((n) => n.node),\n                );\n                tr.replaceWith(start, end, groupNode);\n                modified = true;\n              }\n              return false;\n            }\n          });\n\n          return modified ? tr : null;\n        },\n      }),\n    ];\n  },\n});\n"],"names":["parent"],"mappings":";;AA+BO,MAAM,sBAAsB,KAAK,OAAO;AAAA,EAC7C,MAAM;AAAA,EACN,OAAO;AAAA,EACP,SAAS;AAAA,EAET,YAAY;AACV,WAAO;AAAA,MACL;AAAA,QACE,KAAK;AAAA,MAAA;AAAA,IACP;AAAA,EAEJ;AAAA,EAEA,WAAW,EAAE,kBAAkB;AAC7B,WAAO;AAAA,MACL;AAAA,MACA,gBAAgB,gBAAgB,EAAE,OAAO,wBAAwB;AAAA,MACjE;AAAA,IAAA;AAAA,EAEJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,wBAAwB;AACtB,WAAO;AAAA,MACL,IAAI,OAAO;AAAA,QACT,mBAAmB,CAAC,cAAc,UAAU,aAAa;AACvD,gBAAM,KAAK,SAAS;AACpB,cAAI,WAAW;AACf,gBAAM,eAAe,CAAA;AAErB,0BAAS,IAAI,YAAY,CAAC,MAAM,KAAK,WAAW;AAC9C,gBACE,KAAK,KAAK,SAAS,oBACnB,OAAO,KAAK,SAAS,OACrB;AACA,oBAAM,QAAQ,KACR,MAAM,SAAS,IAAI,QAAQ;AAajC,kBAXA,SAAS,IAAI,aAAa,OAAO,KAAK,CAAC,GAAG,GAAGA,YAAW;AACtD,oBACE,EAAE,KAAK,SAAS,oBAChBA,QAAO,KAAK,SAAS;AAErB,+BAAa,KAAK,EAAE,MAAM,GAAG,KAAK,GAAG;AAAA;AAErC,yBAAO;AAAA,cAEX,CAAC,GAEG,aAAa,SAAS,GAAG;AAC3B,sBAAM,YAAY,KAAK,KAAK;AAAA,kBAC1B,CAAA;AAAA,kBACA,aAAa,IAAI,CAAC,MAAM,EAAE,IAAI;AAAA,gBAAA;AAEhC,mBAAG,YAAY,OAAO,KAAK,SAAS,GACpC,WAAW;AAAA,cACb;AACA,qBAAO;AAAA,YACT;AAAA,UACF,CAAC,GAEM,WAAW,KAAK;AAAA,QACzB;AAAA,MAAA,CACD;AAAA,IAAA;AAAA,EAEL;AACF,CAAC;"}